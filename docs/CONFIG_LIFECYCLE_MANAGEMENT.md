# é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†å­˜æ¡£æ–‡æ¡£

**Frontmatter:**
---
title: "é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†å­˜æ¡£æ–‡æ¡£"
description: "è®°å½•dev-envé¡¹ç›®ä»v2.1åˆ°v3.0çš„å®Œæ•´é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ç®¡ç†ã€è¿ç§»ç­–ç•¥ã€å¥åº·æ£€æŸ¥å’Œé”™è¯¯æ¢å¤æœºåˆ¶"
type: "architecture"
status: "archived"
priority: "high"
created_date: "2025-01-31"
last_updated: "2025-01-31"
version: "1.0.0"
related_documents:
  - "OPTIMIZATION_RECOMMENDATIONS_V2.md"
  - "OPTIMIZATION_RECOMMENDATIONS.md"
  - "management/PRD.md"
  - "management/PLANNING.md"
related_code:
  - "scripts/install_zsh_config.sh"
  - "scripts/zsh_tools.sh"
  - "scripts/zsh_version_manager.sh"
  - "scripts/zsh_migrate.sh"
tags:
  - "lifecycle-management"
  - "version-control"
  - "migration"
  - "health-check"
  - "recovery"
  - "architecture"
---

## æ–‡æ¡£ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|-----|
| **æ–‡æ¡£ç±»å‹** | æ¶æ„å­˜æ¡£æ–‡æ¡£ |
| **çŠ¶æ€** | å·²å­˜æ¡£ |
| **é€‚ç”¨ç‰ˆæœ¬** | v2.1 â†’ v3.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-01-31 |
| **ç»´æŠ¤è€…** | Dev-Env Team |
| **å®¡æ ¸çŠ¶æ€** | å·²å®¡æ ¸ |

---

## ç›®å½•

1. [ä¸Šä¸‹æ–‡èƒŒæ™¯](#1-ä¸Šä¸‹æ–‡èƒŒæ™¯)
2. [é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†è¯¦è§£](#2-é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†è¯¦è§£)
3. [æŠ€æœ¯è®¾è®¡ç»†èŠ‚](#3-æŠ€æœ¯è®¾è®¡ç»†èŠ‚)
4. [å®æ–½è®¡åˆ’](#4-å®æ–½è®¡åˆ’)
5. [é™„å½•](#5-é™„å½•)

---

## 1. ä¸Šä¸‹æ–‡èƒŒæ™¯

### 1.1 é¡¹ç›®ç°çŠ¶ (dev-env v2.1)

#### ç‰ˆæœ¬ä¿¡æ¯

| ç»„ä»¶ | ç‰ˆæœ¬ | çŠ¶æ€ |
|------|------|------|
| **å½“å‰ç‰ˆæœ¬** | v2.1.1 | ç¨³å®š |
| **ç›®æ ‡ç‰ˆæœ¬** | v3.0 | è§„åˆ’ä¸­ |
| **æ ¸å¿ƒè„šæœ¬** | 7ä¸ª | æ´»è·ƒç»´æŠ¤ |
| **é…ç½®æ–‡ä»¶** | 4ä¸ª | æ­£å¸¸ä½¿ç”¨ |
| **æ–‡æ¡£æ•°é‡** | 32+ | å®Œæ•´ |

#### æ ¸å¿ƒç»„ä»¶

```
dev-env v2.1 æ¶æ„
â”œâ”€â”€ é…ç½®ç®¡ç†å±‚
â”‚   â”œâ”€â”€ config/.zshrc (ä¸»é…ç½®)
â”‚   â”œâ”€â”€ config/.zshrc.optimized (æ€§èƒ½ä¼˜åŒ–)
â”‚   â”œâ”€â”€ config/.zshrc.ultra-optimized (è¶…é«˜æ€§èƒ½)
â”‚   â””â”€â”€ config/.p10k.zsh (Powerlevel10kä¸»é¢˜)
â”œâ”€â”€ è„šæœ¬å·¥å…·å±‚
â”‚   â”œâ”€â”€ install_zsh_config.sh (è‡ªåŠ¨å®‰è£…)
â”‚   â”œâ”€â”€ zsh_tools.sh (é…ç½®ç®¡ç†)
â”‚   â”œâ”€â”€ zsh_optimizer.sh (æ€§èƒ½ä¼˜åŒ–)
â”‚   â”œâ”€â”€ zsh_launcher.sh (å¤šæ¨¡å¼å¯åŠ¨)
â”‚   ï¿½ï¿½â”€â”€ zsh_minimal.sh (æç®€å¯åŠ¨)
â””â”€â”€ å‡½æ•°æ¨¡å—å±‚
    â”œâ”€â”€ environment.zsh (ç¯å¢ƒæ£€æµ‹)
    â”œâ”€â”€ search.zsh (æœç´¢å¢å¼º)
    â”œâ”€â”€ utils.zsh (å®ç”¨å·¥å…·)
    â”œâ”€â”€ help.zsh (å¸®åŠ©ç³»ç»Ÿ)
    â””â”€â”€ performance.zsh (æ€§èƒ½åˆ†æ)
```

#### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | v2.1 æ€§èƒ½ | ç›®æ ‡ |
|------|----------|------|
| æé€Ÿæ¨¡å¼å¯åŠ¨ | 2ms | ä¿æŒ |
| å¿«é€Ÿæ¨¡å¼å¯åŠ¨ | 0.606s | <0.5s |
| æ ‡å‡†æ¨¡å¼å¯åŠ¨ | 1.568s | <1.2s |
| å†…å­˜å ç”¨ | 35MB | <40MB |
| æ’ä»¶æ•°é‡ | 8-10ä¸ª | ä¼˜åŒ–åŠ è½½ |

---

### 1.2 å·²å®Œæˆçš„å·¥ä½œ (P0/P1ä»»åŠ¡)

#### P0 ä»»åŠ¡ - å·²å®Œæˆ âœ…

| ä»»åŠ¡ | å®Œæˆæ—¥æœŸ | æˆæœ |
|------|----------|------|
| lsé¢œè‰²ä¿®å¤ | 2025-10-19 | dircolorsé…ç½® |
| tmuxä¸»é¢˜ä¿®å¤ | 2025-10-19 | POWERLEVEL9K_INSTANT_PROMPT=quiet |
| Matrixç³»ç»Ÿè¯†åˆ« | 2025-10-19 | ç¯å¢ƒæ£€æµ‹åŠŸèƒ½ |
| PATHå®‰å…¨ä¿æŠ¤ | 2025-10-20 | é˜²æ­¢PATHæ±¡æŸ“ |
| j/jdevä¿®å¤ | 2025-10-20 | æ¶ˆé™¤ç¡¬ç¼–ç è·¯å¾„ |
| é”™è¯¯å¤„ç†å¢å¼º | 2025-10-20 | ä¸‰å±‚é”™è¯¯å¤„ç†æœºåˆ¶ |
| æ–‡æ¡£ä¼˜åŒ– | 2025-11-11 | ç®¡ç†å±‚ç˜¦èº«60% |
| Frontmatterè¡¥å…… | 2025-11-11 | 11ä¸ªæ–‡æ¡£100%è¦†ç›– |

#### P1 ä»»åŠ¡ - å·²å®Œæˆ âœ…

| ä»»åŠ¡ | å®Œæˆæ—¥æœŸ | æˆæœ |
|------|----------|------|
| Claude CLIç³»ç»Ÿ | 2025-10-22 | å®Œæ•´é…ç½®ç®¡ç† |
| ä»£ç†åŠŸèƒ½ä¼˜åŒ– | 2025-10-17 | å…¨é¢æ”¯æŒ |
| ç¯å¢ƒæŒ‡ç¤ºç¬¦ | 2025-10-16 | P10Ké›†æˆ |
| å¤šæ¨¡å¼å¯åŠ¨ | 2025-10-16 | 3ç§å¯åŠ¨æ¨¡å¼ |
| æ€§èƒ½åˆ†æç³»ç»Ÿ | 2025-10-16 | è¯¦ç»†æŠ¥å‘Š |

---

### 1.3 ä¼˜åŒ–å»ºè®®æ€»ç»“

#### ç¬¬ä¸€è½®ä¼˜åŒ–å»ºè®® (å·²å®Œæˆ)

1. âœ… lsé¢œè‰²ä¿®å¤ (dircolorsé…ç½®)
2. âœ… tmuxä¸»é¢˜ä¿®å¤ (POWERLEVEL9K_INSTANT_PROMPT)
3. âœ… Matrixç³»ç»ŸåŠŸèƒ½é›†æˆ
4. â³ æ¨¡å—åŒ–é…ç½®ç³»ç»Ÿ (è¿›è¡Œä¸­)
5. â³ Matrixç³»ç»Ÿå®‰è£…è„šæœ¬ (å¾…å®æ–½)
6. â³ PATHå®‰å…¨ä¿æŠ¤ (å·²å®Œæˆ)
7. â³ é…ç½®é¢„è®¾ç³»ç»Ÿ (è§„åˆ’ä¸­)

#### ç¬¬äºŒè½®ä¼˜åŒ–å»ºè®® (å¾…å®æ–½)

##### 3.1 é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç† â­â­â­â­â­

| å»ºè®® | ä¼˜å…ˆçº§ | çŠ¶æ€ | é¢„æœŸæ•ˆæœ |
|------|--------|------|----------|
| é…ç½®ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ | â­â­â­â­â­ | å¾…å®æ–½ | è¿½è¸ªç‰ˆæœ¬ã€æ”¯æŒå›æ»š |
| é…ç½®è¿ç§»å·¥å…· | â­â­â­â­â­ | å¾…å®æ–½ | ä¿ç•™ç”¨æˆ·è‡ªå®šä¹‰ |
| é…ç½®å·®å¼‚åˆ†æ | â­â­â­â­ | å¾…å®æ–½ | æ˜¾ç¤ºé…ç½®å·®å¼‚ |

##### 3.2 ç³»ç»Ÿå¥åº·å’Œå¯é æ€§ â­â­â­â­â­

| å»ºè®® | ä¼˜å…ˆçº§ | çŠ¶æ€ | é¢„æœŸæ•ˆæœ |
|------|--------|------|----------|
| å¥åº·æ£€æŸ¥è„šæœ¬ | â­â­â­â­â­ | å¾…å®æ–½ | å…¨é¢æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ |
| å®‰å…¨æ¨¡å¼å¯åŠ¨ | â­â­â­â­ | å¾…å®æ–½ | é…ç½®é”™è¯¯æ—¶å¯ç”¨ |
| è‡ªåŠ¨é”™è¯¯æ¢å¤ | â­â­â­â­ | å¾…å®æ–½ | é…ç½®å¤±è´¥è‡ªåŠ¨å›æ»š |

##### 3.3 æµ‹è¯•å’Œè´¨é‡ç®¡ç† â­â­â­â­

| å»ºè®® | ä¼˜å…ˆçº§ | çŠ¶æ€ | é¢„æœŸæ•ˆæœ |
|------|--------|------|----------|
| å¢å¼ºæµ‹è¯•è¦†ç›–ç‡ | â­â­â­â­â­ | è¿›è¡Œä¸­ | 80%+è¦†ç›–ç‡ |
| CI/CDé›†æˆ | â­â­â­â­ | å¾…å®æ–½ | è‡ªåŠ¨åŒ–æµ‹è¯•å‘å¸ƒ |
| æ€§èƒ½å›å½’æµ‹è¯• | â­â­â­â­ | å¾…å®æ–½ | é˜²æ­¢æ€§èƒ½é€€åŒ– |

##### 3.4 ä¼ä¸šçº§ç‰¹æ€§ â­â­â­â­

| å»ºè®® | ä¼˜å…ˆçº§ | çŠ¶æ€ | é¢„æœŸæ•ˆæœ |
|------|--------|------|----------|
| æ—¥å¿—ç³»ç»Ÿ | â­â­â­â­ | å¾…å®æ–½ | è®°å½•æ‰€æœ‰æ“ä½œ |
| é…ç½®å®¡è®¡ | â­â­â­ | å¾…å®æ–½ | è·Ÿè¸ªå˜æ›´å†å² |
| å¤šç¯å¢ƒé…ç½® | â­â­â­â­ | å¾…å®æ–½ | æ”¯æŒå¤šç¯å¢ƒ |

---

## 2. é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†è¯¦è§£

### 2.1 æ¦‚å¿µè§£é‡Š

#### ä»€ä¹ˆæ˜¯é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†?

é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç† (Configuration Lifecycle Management, CLM) æ˜¯æŒ‡å¯¹ZSHé…ç½®æ–‡ä»¶ä»åˆ›å»ºã€ä½¿ç”¨ã€å‡çº§åˆ°åºŸå¼ƒçš„å…¨è¿‡ç¨‹è¿›è¡Œç³»ç»ŸåŒ–ç®¡ç†ã€‚

#### ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é…ç½®ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. åˆå§‹åŒ–é˜¶æ®µ (Initialization)                                 â”‚
â”‚     â”œâ”€â”€ é¦–æ¬¡å®‰è£…                                                 â”‚
â”‚     â”œâ”€â”€ ç¯å¢ƒæ£€æµ‹                                                 â”‚
â”‚     â””â”€â”€ ä¾èµ–æ£€æŸ¥                                                 â”‚
â”‚                                                                  â”‚
â”‚  2. ä½¿ç”¨é˜¶æ®µ (Usage)                                             â”‚
â”‚     â”œâ”€â”€ æ—¥å¸¸ä½¿ç”¨                                                 â”‚
â”‚     â”œâ”€â”€ è‡ªå®šä¹‰é…ç½®                                               â”‚
â”‚     â””â”€â”€ æ€§èƒ½ç›‘æ§                                                 â”‚
â”‚                                                                  â”‚
â”‚  3. ç»´æŠ¤é˜¶æ®µ (Maintenance)                                      â”‚
â”‚     â”œâ”€â”€ å¥åº·æ£€æŸ¥                                                 â”‚
â”‚     â”œâ”€â”€ é…ç½®éªŒè¯                                                 â”‚
â”‚     â””â”€â”€ é—®é¢˜ä¿®å¤                                                 â”‚
â”‚                                                                  â”‚
â”‚  4. å‡çº§é˜¶æ®µ (Upgrade)                                          â”‚
â”‚     â”œâ”€â”€ ç‰ˆæœ¬æ£€æŸ¥                                                 â”‚
â”‚     â”œâ”€â”€ é…ç½®è¿ç§»                                                 â”‚
â”‚     â””â”€â”€ å˜æ›´åº”ç”¨                                                 â”‚
â”‚                                                                  â”‚
â”‚  5. æ¢å¤é˜¶æ®µ (Recovery)                                         â”‚
â”‚     â”œâ”€â”€ å¤‡ä»½æ¢å¤                                                 â”‚
â”‚     â”œâ”€â”€ ç‰ˆæœ¬å›æ»š                                                 â”‚
â”‚     â””â”€â”€ é”™è¯¯ä¿®å¤                                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.2 æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### 2.2.1 ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ

##### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é…ç½®ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿæ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç‰ˆæœ¬æ–‡ä»¶    â”‚â”€â”€â”€â”€â–¶â”‚  ç‰ˆæœ¬æ£€æŸ¥å™¨   â”‚â”€â”€â”€â”€â–¶â”‚  ç‰ˆæœ¬æ¯”è¾ƒå™¨   â”‚ â”‚
â”‚  â”‚ ~/.zsh-ver   â”‚     â”‚ zsh_version  â”‚     â”‚ zsh_compare  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                           â”‚         â”‚
â”‚         â–¼                                           â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç‰ˆæœ¬å‡çº§å™¨  â”‚â—€â”€â”€â”€â”€â”‚  ç‰ˆæœ¬å†å²    â”‚â”€â”€â”€â”€â–¶â”‚  ç‰ˆæœ¬å›æ»šå™¨  â”‚ â”‚
â”‚  â”‚ zsh_upgrade  â”‚     â”‚ zsh_history  â”‚     â”‚ zsh_rollback â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ç‰ˆæœ¬æ–‡ä»¶æ ¼å¼

```bash
# ~/.zsh-version
# ZSHé…ç½®ç‰ˆæœ¬æ–‡ä»¶
# æ ¼å¼: KEY=VALUE

# ç‰ˆæœ¬ä¿¡æ¯
ZSH_VERSION="2.1.1"
CONFIG_HASH="sha256:abc123def456..."
CONFIG_SCHEMA="1.0"

# å®‰è£…ä¿¡æ¯
INSTALLED_DATE="2025-01-31T10:30:00+08:00"
INSTALL_SOURCE="dev-env"
INSTALL_METHOD="script"

# ä¾èµ–ä¿¡æ¯
ANTIGEN_VERSION="2.x"
P10K_VERSION="1.x"
ZSH_VERSION="5.8.1"

# è‡ªå®šä¹‰ä¿¡æ¯
CUSTOM_CONFIG_COUNT=5
CUSTOM_PLUGINS_COUNT=2

# æ›´æ–°ä¿¡æ¯
LAST_CHECK_DATE="2025-01-31T10:30:00+08:00"
LAST_UPDATE_DATE="2025-01-31T10:30:00+08:00"
UPDATE_CHANNEL="stable"

# å¤‡ä»½ä¿¡æ¯
LAST_BACKUP_DATE="2025-01-30T15:20:00+08:00"
BACKUP_PATH="/home/user/zsh-backup-20250130-152000"
```

##### æ ¸å¿ƒåŠŸèƒ½

```bash
# scripts/zsh_version_manager.sh

# ç‰ˆæœ¬ç®¡ç†å‘½ä»¤
zsh_version_current()     # æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬
zsh_version_check()       # æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
zsh_version_upgrade()     # å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
zsh_version_rollback()    # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
zsh_version_history()     # æ˜¾ç¤ºç‰ˆæœ¬å†å²
zsh_version_diff()        # æ¯”è¾ƒç‰ˆæœ¬å·®å¼‚
```

---

#### 2.2.2 é…ç½®è¿ç§»å·¥å…·

##### è¿ç§»ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é…ç½®è¿ç§»ç­–ç•¥æ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  æ—§é…ç½® (~/.zshrc)                                           â”‚
â”‚       â”‚                                                       â”‚
â”‚       â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  è§£æå™¨      â”‚ è§£æé…ç½®æ–‡ä»¶                               â”‚
â”‚  â”‚  Parser      â”‚ è¯†åˆ«è‡ªå®šä¹‰åŒºåŸŸ                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚       â”‚                                                       â”‚
â”‚       â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  é…ç½®åˆ†ç±»                            â”‚                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚  â”‚ â€¢ ç®¡ç†åŒºåŸŸ (Managed)                â”‚                   â”‚
â”‚  â”‚   â””â”€â”€ æ ‡è®°: # === BEGIN: Managed === â”‚                   â”‚
â”‚  â”‚ â€¢ è‡ªå®šä¹‰åŒºåŸŸ (Custom)               â”‚                   â”‚
â”‚  â”‚   â””â”€â”€ æ ‡è®°: # === User Custom ===   â”‚                   â”‚
â”‚  â”‚ â€¢ ç¯å¢ƒç‰¹å®š (Environment)            â”‚                   â”‚
â”‚  â”‚   â””â”€â”€ æ ‡è®°: # === Environment ===   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                                                       â”‚
â”‚       â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  åˆå¹¶å™¨      â”‚ æ™ºèƒ½åˆå¹¶                                   â”‚
â”‚  â”‚  Merger      â”‚ â€¢ ä¿ç•™ç”¨æˆ·è‡ªå®šä¹‰                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â€¢ åº”ç”¨æ–°ç‰ˆæœ¬ç®¡ç†åŒºåŸŸ                      â”‚
â”‚       â”‚             â€¢ å¤„ç†å†²çª                               â”‚
â”‚       â–¼                                                       â”‚
â”‚  æ–°é…ç½® (~/.zshrc)                                           â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### é…ç½®æ–‡ä»¶æ ‡è®°æ ¼å¼

```bash
# ~/.zshrc
# ===============================================
# Managed by dev-env v2.1.1
# DO NOT edit this section manually
# Changes will be overwritten on upgrade
# ===============================================
# === BEGIN: Managed by dev-env ===

# Powerlevel10k instant prompt
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Antigen configuration
source "$HOME/.antigen.zsh"
antigen use oh-my-zsh
antigen bundle git
# ... æ›´å¤šé…ç½®

# === END: Managed by dev-env ===

# ===============================================
# User Custom Configuration
# This section is preserved during upgrades
# ===============================================
# === BEGIN: User Custom ===

# Your custom aliases
alias myproject='cd ~/projects/myproject'

# Your custom functions
myfunction() {
    echo "My custom function"
}

# === END: User Custom ===

# ===============================================
# Environment Specific Configuration
# ===============================================
# === BEGIN: Environment ===

# Work environment
if [[ -f "$HOME/.zshrc.work" ]]; then
    source "$HOME/.zshrc.work"
fi

# === END: Environment ===
```

##### æ ¸å¿ƒåŠŸèƒ½

```bash
# scripts/zsh_migrate.sh

# è¿ç§»å‘½ä»¤
migrate_analyze()          # åˆ†æç°æœ‰é…ç½®
migrate_preserve_custom()  # ä¿ç•™ç”¨æˆ·è‡ªå®šä¹‰
migrate_merge()            # åˆå¹¶æ–°æ—§é…ç½®
migrate_validate()         # éªŒè¯è¿ç§»ç»“æœ
migrate_rollback()         # å›æ»šè¿ç§»
```

---

#### 2.2.3 å¥åº·æ£€æŸ¥ç³»ç»Ÿ

##### æ£€æŸ¥æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¥åº·æ£€æŸ¥ç³»ç»Ÿæ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              å¥åº·æ£€æŸ¥åè°ƒå™¨                         â”‚     â”‚
â”‚  â”‚         zsh_health_check_coordinator               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚                                   â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚        â–¼                 â–¼                 â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ é…ç½®æ£€æŸ¥  â”‚    â”‚ ä¾èµ–æ£€æŸ¥  â”‚    â”‚ åŠŸèƒ½æ£€æŸ¥  â”‚            â”‚
â”‚  â”‚  Config   â”‚    â”‚ Dependencyâ”‚    â”‚ Function  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚        â”‚                 â”‚                 â”‚                â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                          â–¼                                   â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                â”‚  å¥åº·æŠ¥å‘Šç”Ÿæˆ   â”‚                          â”‚
â”‚                â”‚ Report Generatorâ”‚                          â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½â”                          â”‚
â”‚                â”‚  ä¿®å¤å»ºè®®ç”Ÿæˆ   â”‚                          â”‚
â”‚                â”‚ Fix Recommender â”‚                          â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### æ£€æŸ¥é¡¹ç›®æ¸…å•

```yaml
health_checks:
  config:
    - name: "é…ç½®æ–‡ä»¶è¯­æ³•"
      check: "zsh_syntax_check"
      severity: "critical"
      auto_fix: false

    - name: "é…ç½®æ–‡ä»¶æƒé™"
      check: "config_permissions"
      severity: "warning"
      auto_fix: true

    - name: "ç‰ˆæœ¬æ–‡ä»¶å®Œæ•´æ€§"
      check: "version_file_integrity"
      severity: "warning"
      auto_fix: true

  dependencies:
    - name: "ZSHç‰ˆæœ¬"
      check: "zsh_version_check"
      required: ">=5.8"
      severity: "critical"
      auto_fix: false

    - name: "Antigenå®‰è£…"
      check: "antigen_installed"
      severity: "critical"
      auto_fix: true

    - name: "Powerlevel10k"
      check: "p10k_installed"
      severity: "warning"
      auto_fix: true

    - name: "å¼€å‘å·¥å…·"
      check: "dev_tools_check"
      tools: ["fzf", "fd", "rg"]
      severity: "info"
      auto_fix: true

  functions:
    - name: "è‡ªå®šä¹‰å‡½æ•°åŠ è½½"
      check: "functions_loaded"
      required:
        - "check_environment"
        - "reload_zsh"
        - "zsh_help"
      severity: "warning"
      auto_fix: false

  performance:
    - name: "å¯åŠ¨æ—¶é—´"
      check: "startup_time"
      threshold: "2.0s"
      severity: "warning"
      auto_fix: false

    - name: "å†…å­˜å ç”¨"
      check: "memory_usage"
      threshold: "50MB"
      severity: "info"
      auto_fix: false

  security:
    - name: "PATHå®‰å…¨"
      check: "path_safety"
      severity: "warning"
      auto_fix: true

    - name: "æ•æ„Ÿæ–‡ä»¶æƒé™"
      check: "sensitive_file_perms"
      severity: "warning"
      auto_fix: true
```

##### æ ¸å¿ƒåŠŸèƒ½

```bash
# scripts/zsh_health_check.sh

# å¥åº·æ£€æŸ¥å‘½ä»¤
check_health()              # å…¨é¢å¥åº·æ£€æŸ¥
check_config()              # é…ç½®æ£€æŸ¥
check_dependencies()        # ä¾èµ–æ£€æŸ¥
check_functions()           # å‡½æ•°æ£€æŸ¥
check_performance()         # æ€§èƒ½æ£€æŸ¥
check_security()            # å®‰å…¨æ£€æŸ¥
generate_health_report()    # ç”Ÿæˆå¥åº·æŠ¥å‘Š
provide_fix_suggestions()   # æä¾›ä¿®å¤å»ºè®®
```

---

#### 2.2.4 é”™è¯¯æ¢å¤æœºåˆ¶

##### æ¢å¤æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é”™è¯¯æ¢å¤æœºåˆ¶æ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  æ­£å¸¸è¿è¡Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚       â”‚                                     â”‚                 â”‚
â”‚       â–¼                                     â”‚                 â”‚
â”‚  é…ç½®åŠ è½½                                    â”‚                 â”‚
â”‚       â”‚                                     â”‚                 â”‚
â”‚       â”œâ”€â”€ æˆåŠŸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚       â”‚                                     â”‚                 â”‚
â”‚       â””â”€â”€ å¤±è´¥                                â”‚                 â”‚
â”‚           â”‚                                  â”‚                 â”‚
â”‚           â–¼                                  â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                 â”‚
â”‚  â”‚   é”™è¯¯æ£€æµ‹å™¨          â”‚                  â”‚                 â”‚
â”‚  â”‚   Error Detector     â”‚                  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                 â”‚
â”‚           â”‚                                  â”‚                 â”‚
â”‚           â–¼                                  â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                 â”‚
â”‚  â”‚   é”™è¯¯åˆ†ç±»å™¨          â”‚                  â”‚                 â”‚
â”‚  â”‚   Error Classifier   â”‚                  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                 â”‚
â”‚       â”‚          â”‚                          â”‚                 â”‚
â”‚       â”œâ”€â”€ è¯­æ³•é”™è¯¯                          â”‚                 â”‚
â”‚       â”œâ”€â”€ ä¾èµ–ç¼ºå¤±                          â”‚                 â”‚
â”‚       â”œâ”€â”€ é…ç½®å†²çª                          â”‚                 â”‚
â”‚       â””â”€â”€ æ€§èƒ½é—®é¢˜                          â”‚                 â”‚
â”‚       â”‚          â”‚                          â”‚                 â”‚
â”‚       â–¼          â–¼                          â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                 â”‚
â”‚  â”‚   è‡ªåŠ¨æ¢å¤å™¨          â”‚                  â”‚                 â”‚
â”‚  â”‚   Auto Recovery      â”‚                  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                 â”‚
â”‚           â”‚                                  â”‚                 â”‚
â”‚           â”œâ”€â”€ åº”ç”¨å¤‡ä»½                       â”‚                 â”‚
â”‚           â”œâ”€â”€ ç¦ç”¨é—®é¢˜æ’ä»¶                   â”‚                 â”‚
â”‚           â”œâ”€â”€ é™çº§åˆ°å®‰å…¨æ¨¡å¼                 â”‚                 â”‚
â”‚           â””â”€â”€ ä¿®å¤è¯­æ³•é”™è¯¯                   â”‚                 â”‚
â”‚           â”‚                                  â”‚                 â”‚
â”‚           â–¼                                  â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                 â”‚
â”‚  â”‚   æ¢å¤éªŒè¯å™¨          â”‚                  â”‚                 â”‚
â”‚  â”‚   Recovery Validator â”‚                  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                 â”‚
â”‚           â”‚                                  â”‚                 â”‚
â”‚           â”œâ”€â”€ æˆåŠŸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚           â”‚                                  â”‚                 â”‚
â”‚           â””â”€â”€ å¤±è´¥                           â”‚                 â”‚
â”‚               â”‚                              â”‚                 â”‚
â”‚               â–¼                              â”‚                 â”‚
â”‚          å®‰å…¨æ¨¡å¼å¯åŠ¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### é”™è¯¯åˆ†ç±»å’Œå¤„ç†

```yaml
error_recovery:
  syntax_errors:
    detection:
      - "zsh -n ~/.zshrc"
      - "è§£æé”™è¯¯æ—¥å¿—"
    auto_fix:
      - "æ¢å¤æœ€è¿‘å¤‡ä»½"
      - "ç¦ç”¨é—®é¢˜å‡½æ•°"
      - "ä½¿ç”¨å®‰å…¨é…ç½®"
    manual_fix:
      - "è¿è¡Œzsh --no-rcs"
      - "æ‰‹åŠ¨ç¼–è¾‘é…ç½®"
      - "æŸ¥çœ‹é”™è¯¯æ—¥å¿—"

  dependency_errors:
    detection:
      - "æ£€æŸ¥å¿…éœ€å‘½ä»¤"
      - "éªŒè¯æ’ä»¶å®‰è£…"
    auto_fix:
      - "é‡æ–°å®‰è£…Antigen"
      - "æ›´æ–°æ’ä»¶"
      - "ä½¿ç”¨å¤‡ç”¨æº"
    manual_fix:
      - "æ‰‹åŠ¨å®‰è£…ä¾èµ–"
      - "æ£€æŸ¥ç½‘ç»œè¿æ¥"

  performance_errors:
    detection:
      - "å¯åŠ¨æ—¶é—´ç›‘æ§"
      - "å†…å­˜ä½¿ç”¨æ£€æŸ¥"
    auto_fix:
      - "æ¸…ç†ç¼“å­˜"
      - "ç¦ç”¨æ…¢é€Ÿæ’ä»¶"
      - "åˆ‡æ¢åˆ°å¿«é€Ÿæ¨¡å¼"
    manual_fix:
      - "è¿è¡Œæ€§èƒ½åˆ†æ"
      - "ä¼˜åŒ–é…ç½®"

  config_conflicts:
    detection:
      - "é…ç½®æ–‡ä»¶æ¯”è¾ƒ"
      - "æ’ä»¶å†²çªæ£€æµ‹"
    auto_fix:
      - "åº”ç”¨é»˜è®¤é…ç½®"
      - "ç¦ç”¨å†²çªæ’ä»¶"
    manual_fix:
      - "æŸ¥çœ‹å·®å¼‚æŠ¥å‘Š"
      - "æ‰‹åŠ¨åˆå¹¶é…ç½®"
```

##### æ ¸å¿ƒåŠŸèƒ½

```bash
# scripts/zsh_recovery.sh

# æ¢å¤å‘½ä»¤
enable_safe_mode()         # å¯ç”¨å®‰å…¨æ¨¡å¼
auto_recover()             # è‡ªåŠ¨æ¢å¤
restore_backup()           # æ¢å¤å¤‡ä»½
disable_problem_plugin()   # ç¦ç”¨é—®é¢˜æ’ä»¶
fix_syntax_error()         # ä¿®å¤è¯­æ³•é”™è¯¯
validate_recovery()        # éªŒè¯æ¢å¤ç»“æœ
```

---

## 3. æŠ€æœ¯è®¾è®¡ç»†èŠ‚

### 3.1 ç‰ˆæœ¬ç®¡ç†æœºåˆ¶

#### 3.1.1 ç‰ˆæœ¬å·è§„èŒƒ

##### è¯­ä¹‰åŒ–ç‰ˆæœ¬ (SemVer)

```
ç‰ˆæœ¬æ ¼å¼: MAJOR.MINOR.PATCH

MAJOR:   ä¸å…¼å®¹çš„APIå˜æ›´
MINOR:   å‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢
PATCH:   å‘åå…¼å®¹çš„é—®é¢˜ä¿®å¤

ç¤ºä¾‹: 2.1.1
  MAJOR = 2 (ä¸»è¦ç‰ˆæœ¬)
  MINOR = 1 (åŠŸèƒ½ç‰ˆæœ¬)
  PATCH = 1 (è¡¥ä¸ç‰ˆæœ¬)
```

##### é…ç½®ç‰ˆæœ¬

```
é…ç½®ç‰ˆæœ¬: CONFIG-VERSION

æ ¼å¼: v{MAJOR}.{MINOR}

ç¤ºä¾‹:
  v2.1 - é…ç½®schemaç‰ˆæœ¬
  ä¸è½¯ä»¶ç‰ˆæœ¬åˆ†å¼€ç®¡ç†
```

#### 3.1.2 ç‰ˆæœ¬æ£€æŸ¥æœºåˆ¶

```bash
# ç‰ˆæœ¬æ¯”è¾ƒå‡½æ•°
version_compare() {
    local current="$1"
    local target="$2"

    # åˆ†å‰²ç‰ˆæœ¬å·
    IFS='.' read -ra CURRENT_VER <<< "$current"
    IFS='.' read -ra TARGET_VER <<< "$target"

    # æ¯”è¾ƒä¸»ç‰ˆæœ¬
    if [[ ${CURRENT_VER[0]} -lt ${TARGET_VER[0]} ]]; then
        return 1  # éœ€è¦å‡çº§
    elif [[ ${CURRENT_VER[0]} -gt ${TARGET_VER[0]} ]]; then
        return 0  # å½“å‰ç‰ˆæœ¬æ›´æ–°
    fi

    # æ¯”è¾ƒæ¬¡ç‰ˆæœ¬
    if [[ ${CURRENT_VER[1]} -lt ${TARGET_VER[1]} ]]; then
        return 1  # éœ€è¦å‡çº§
    elif [[ ${CURRENT_VER[1]} -gt ${TARGET_VER[1]} ]]; then
        return 0  # å½“å‰ç‰ˆæœ¬æ›´æ–°
    fi

    # æ¯”è¾ƒè¡¥ä¸ç‰ˆæœ¬
    if [[ ${CURRENT_VER[2]} -lt ${TARGET_VER[2]} ]]; then
        return 1  # éœ€è¦å‡çº§
    fi

    return 0  # ç‰ˆæœ¬ç›¸åŒæˆ–æ›´æ–°
}

# æ£€æŸ¥æ›´æ–°
check_update() {
    local current_version=$(get_current_version)
    local remote_version=$(get_remote_version)

    if version_compare "$current_version" "$remote_version"; then
        echo "å·²æ˜¯æœ€æ–°ç‰ˆæœ¬: $current_version"
        return 1
    else
        echo "æœ‰æ–°ç‰ˆæœ¬: $remote_version (å½“å‰: $current_version)"
        return 0
    fi
}
```

#### 3.1.3 ç‰ˆæœ¬å†å²è®°å½•

```bash
# ~/.zsh-version-history
# ç‰ˆæœ¬å†å²è®°å½•æ–‡ä»¶

# æ ¼å¼: DATE|VERSION|ACTION|HASH|BACKUP_PATH
2025-01-31T10:30:00|2.1.1|install|abc123|/home/user/zsh-backup-20250131-103000
2025-01-30T15:20:00|2.1.0|upgrade|def456|/home/user/zsh-backup-20250130-152000
2025-01-25T09:10:00|2.0.0|upgrade|ghi789|/home/user/zsh-backup-20250125-091000
2025-01-20T08:00:00|1.3.0|install|jkl012|/home/user/zsh-backup-20250120-080000
```

---

### 3.2 è¿ç§»ç­–ç•¥

#### 3.2.1 è¿ç§»ç±»å‹

| è¿ç§»ç±»å‹ | æè¿° | è‡ªåŠ¨åŒ– | é£é™© |
|---------|------|--------|------|
| **ä¸»ç‰ˆæœ¬å‡çº§** | v2.x â†’ v3.x | éƒ¨åˆ† | é«˜ |
| **æ¬¡ç‰ˆæœ¬å‡çº§** | v2.1 â†’ v2.2 | è‡ªåŠ¨ | ä½ |
| **è¡¥ä¸å‡çº§** | v2.1.1 â†’ v2.1.2 | è‡ªåŠ¨ | æä½ |
| **é…ç½®è¿ç§»** | ä»å…¶ä»–é…ç½® | æ‰‹åŠ¨ | ä¸­ |
| **ç¯å¢ƒè¿ç§»** | è·¨ç¯å¢ƒ | éƒ¨åˆ† | ä¸­ |

#### 3.2.2 è¿ç§»æµç¨‹

```bash
# å®Œæ•´è¿ç§»æµç¨‹
migration_workflow() {
    echo "ğŸ”„ å¼€å§‹é…ç½®è¿ç§»..."

    # 1. é¢„æ£€æŸ¥
    pre_migration_check() {
        echo "1ï¸âƒ£ é¢„æ£€æŸ¥..."
        check_disk_space
        check_backup_available
        check_version_compatibility
    }

    # 2. å¤‡ä»½å½“å‰é…ç½®
    backup_current_config() {
        echo "2ï¸âƒ£ å¤‡ä»½å½“å‰é…ç½®..."
        local backup_dir="$HOME/zsh-backup-$(date +%Y%m%d-%H%M%S)"
        create_backup "$backup_dir"
        echo "$backup_dir" > "$HOME/.zsh_migration_backup"
    }

    # 3. åˆ†æç°æœ‰é…ç½®
    analyze_current_config() {
        echo "3ï¸âƒ£ åˆ†æç°æœ‰é…ç½®..."
        extract_managed_config
        extract_user_custom
        extract_environment_config
        detect_conflicts
    }

    # 4. ç”Ÿæˆè¿ç§»è®¡åˆ’
    generate_migration_plan() {
        echo "4ï¸âƒ£ ç”Ÿæˆè¿ç§»è®¡åˆ’..."
        create_migration_map
        identify_breaking_changes
        list_required_actions
    }

    # 5. æ‰§è¡Œè¿ç§»
    execute_migration() {
        echo "5ï¸âƒ£ æ‰§è¡Œè¿ç§»..."
        apply_new_managed_config
        preserve_user_custom
        merge_environment_config
        resolve_conflicts
    }

    # 6. éªŒè¯è¿ç§»
    verify_migration() {
        echo "6ï¸âƒ£ éªŒè¯è¿ç§»..."
        check_syntax
        test_functionality
        validate_performance
    }

    # 7. åè¿ç§»å¤„ç†
    post_migration() {
        echo "7ï¸âƒ£ åè¿ç§»å¤„ç†..."
        update_version_file
        record_migration_history
        generate_migration_report
        clean_old_backups
    }
}
```

#### 3.2.3 å†²çªè§£å†³ç­–ç•¥

```yaml
conflict_resolution:
  strategy: "interactive"  # interactive | auto | manual

  rules:
    - pattern: "alias_*"
      action: "preserve_user"
      reason: "ç”¨æˆ·åˆ«åä¼˜å…ˆ"

    - pattern: "export PATH_*"
      action: "merge"
      reason: "PATHåˆå¹¶"

    - pattern: "antigen bundle*"
      action: "prefer_new"
      reason: "ä½¿ç”¨æ–°ç‰ˆæœ¬æ’ä»¶é…ç½®"

    - pattern: "*# === User Custom ===*"
      action: "preserve_all"
      reason: "ä¿ç•™ç”¨æˆ·è‡ªå®šä¹‰åŒºåŸŸ"

  merge_methods:
    preserve_user: "ä¿ç•™ç”¨æˆ·é…ç½®ï¼Œå¿½ç•¥æ–°é…ç½®"
    prefer_new: "ä½¿ç”¨æ–°é…ç½®ï¼Œç§»é™¤æ—§é…ç½®"
    merge: "æ™ºèƒ½åˆå¹¶ä¸¤ä¸ªé…ç½®"
    ask_user: "è¯¢é—®ç”¨æˆ·é€‰æ‹©"
    keep_both: "ä¿ç•™ä¸¤ä¸ªé…ç½®ï¼Œæ·»åŠ æ³¨é‡Š"
```

---

### 3.3 å¥åº·æ£€æŸ¥æ–¹æ¡ˆ

#### 3.3.1 æ£€æŸ¥çº§åˆ«

| çº§åˆ« | åç§° | æ£€æŸ¥é¡¹ | è€—æ—¶ | é¢‘ç‡ |
|-----|------|--------|------|------|
| **L1** | å¿«é€Ÿæ£€æŸ¥ | é…ç½®è¯­æ³•ã€å…³é”®æ–‡ä»¶ | <1s | æ¯æ¬¡å¯åŠ¨ |
| **L2** | æ ‡å‡†æ£€æŸ¥ | L1 + ä¾èµ–ã€å‡½æ•° | <5s | æ¯æ—¥ |
| **L3** | å®Œæ•´æ£€æŸ¥ | L2 + æ€§èƒ½ã€å®‰å…¨ | <30s | æ¯å‘¨ |
| **L4** | æ·±åº¦æ£€æŸ¥ | L3 + å‹åŠ›æµ‹è¯• | <5min | æ¯æœˆ |

#### 3.3.2 æ£€æŸ¥é¡¹è¯¦ç»†å®šä¹‰

```bash
# L1: å¿«é€Ÿæ£€æŸ¥
level1_checks() {
    checks=(
        "config_syntax"
        "version_file"
        "critical_files"
    )
}

# L2: æ ‡å‡†æ£€æŸ¥
level2_checks() {
    checks=(
        "${level1_checks[@]}"
        "dependencies"
        "antigen_status"
        "functions_loaded"
    )
}

# L3: å®Œæ•´æ£€æŸ¥
level3_checks() {
    checks=(
        "${level2_checks[@]}"
        "performance"
        "security"
        "plugins_health"
    )
}

# L4: æ·±åº¦æ£€æŸ¥
level4_checks() {
    checks=(
        "${level3_checks[@]}"
        "stress_test"
        "memory_leak"
        "compatibility"
    )
}
```

#### 3.3.3 å¥åº·è¯„åˆ†ç³»ç»Ÿ

```bash
# å¥åº·è¯„åˆ†ç®—æ³•
calculate_health_score() {
    local score=100
    local checks=("$@")
    local passed=0
    local failed=0
    local warnings=0

    for check in "${checks[@]}"; do
        if run_check "$check"; then
            ((passed++))
        else
            local severity=$(get_check_severity "$check")
            case "$severity" in
                "critical")
                    ((score -= 20))
                    ((failed++))
                    ;;
                "warning")
                    ((score -= 5))
                    ((warnings++))
                    ;;
            esac
        fi
    done

    # è¯„çº§
    if [[ $score -ge 90 ]]; then
        local grade="A"  # ä¼˜ç§€
    elif [[ $score -ge 75 ]]; then
        local grade="B"  # è‰¯å¥½
    elif [[ $score -ge 60 ]]; then
        local grade="C"  # ä¸€èˆ¬
    else
        local grade="D"  # éœ€è¦æ”¹è¿›
    fi

    echo "å¥åº·è¯„åˆ†: $score/$100 (ç­‰çº§: $grade)"
    echo "é€šè¿‡: $passed, å¤±è´¥: $failed, è­¦å‘Š: $warnings"
}
```

---

### 3.4 é”™è¯¯æ¢å¤æœºåˆ¶

#### 3.4.1 æ¢å¤è§¦å‘æ¡ä»¶

```yaml
recovery_triggers:
  automatic:
    - condition: "é…ç½®è¯­æ³•é”™è¯¯"
      action: "auto_recover_syntax"
      priority: "critical"

    - condition: "ZSHå¯åŠ¨å¤±è´¥"
      action: "auto_recover_startup"
      priority: "critical"

    - condition: "å…³é”®ä¾èµ–ç¼ºå¤±"
      action: "auto_install_dependencies"
      priority: "high"

  manual:
    - condition: "æ€§èƒ½é€€åŒ–"
      action: "suggest_performance_fix"
      priority: "medium"

    - condition: "é…ç½®å†²çª"
      action: "suggest_conflict_resolution"
      priority: "medium"
```

#### 3.4.2 æ¢å¤ç‚¹ç®¡ç†

```bash
# æ¢å¤ç‚¹åˆ›å»º
create_restore_point() {
    local name="$1"
    local timestamp=$(date +%Y%m%d-%H%M%S)
    local restore_point="$HOME/.zsh-restore-points/$name-$timestamp"

    mkdir -p "$restore_point"

    # ä¿å­˜é…ç½®å¿«ç…§
    cp ~/.zshrc "$restore_point/"
    cp ~/.zsh-version "$restore_point/" 2>/dev/null || true
    cp -r ~/.zsh/functions "$restore_point/" 2>/dev/null || true

    # ä¿å­˜ç³»ç»ŸçŠ¶æ€
    zsh --version > "$restore_point/zsh_version.txt"
    antigen list > "$restore_point/plugins.txt" 2>/dev/null || true

    # ä¿å­˜å…ƒæ•°æ®
    cat > "$restore_point/metadata.json" << EOF
{
    "name": "$name",
    "timestamp": "$timestamp",
    "zsh_version": "$(zsh --version)",
    "config_version": "$(get_config_version)",
    "description": "æ¢å¤ç‚¹: $name"
}
EOF

    echo "æ¢å¤ç‚¹å·²åˆ›å»º: $restore_point"
}

# åˆ—å‡ºæ¢å¤ç‚¹
list_restore_points() {
    echo "å¯ç”¨çš„æ¢å¤ç‚¹:"
    ls -1t ~/.zsh-restore-points/ | while read point; do
        local metadata="$HOME/.zsh-restore-points/$point/metadata.json"
        if [[ -f "$metadata" ]]; then
            echo "  â€¢ $point"
            echo "    $(jq -r '.description' "$metadata")"
        fi
    done
}

# æ¢å¤åˆ°æ¢å¤ç‚¹
restore_to_point() {
    local point_name="$1"
    local restore_point="$HOME/.zsh-restore-points/$point_name"

    if [[ ! -d "$restore_point" ]]; then
        echo "æ¢å¤ç‚¹ä¸å­˜åœ¨: $point_name"
        return 1
    fi

    echo "æ¢å¤åˆ°: $point_name"

    # å¤‡ä»½å½“å‰çŠ¶æ€
    create_restore_point "before-restore-$point_name"

    # æ¢å¤é…ç½®
    cp "$restore_point/.zshrc" ~/.zshrc
    cp "$restore_point/.zsh-version" ~/.zsh-version 2>/dev/null || true
    cp -r "$restore_point/functions" ~/.zsh/ 2>/dev/null || true

    echo "æ¢å¤å®Œæˆ"
    echo "è¯·è¿è¡Œ 'exec zsh' ä»¥åº”ç”¨æ›´æ”¹"
}
```

---

## 4. å®æ–½è®¡åˆ’

### 4.1 æ—¶é—´çº¿

#### é˜¶æ®µ1: æ ¸å¿ƒåŸºç¡€è®¾æ–½ (2-3å‘¨)

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | ä¾èµ– | é¢„æœŸå®Œæˆ |
|-----|--------|--------|------|----------|
| é…ç½®ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ | â­â­â­â­â­ | XL | æ—  | Week 1 |
| é…ç½®è¿ç§»å·¥å…· | â­â­â­â­â­ | XL | ç‰ˆæœ¬ç®¡ç† | Week 2 |
| å¥åº·æ£€æŸ¥è„šæœ¬ | â­â­â­â­â­ | L | ç‰ˆæœ¬ç®¡ç† | Week 2 |
| æ—¥å¿—ç³»ç»Ÿ | â­â­â­â­ | M | æ—  | Week 3 |

**é‡Œç¨‹ç¢‘**: æ ¸å¿ƒç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½å¯ç”¨

#### é˜¶æ®µ2: å¯é æ€§å¢å¼º (2å‘¨)

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | ä¾èµ– | é¢„æœŸå®Œæˆ |
|-----|--------|--------|------|----------|
| å®‰å…¨æ¨¡å¼å¯åŠ¨ | â­â­â­â­ | M | å¥åº·æ£€æŸ¥ | Week 4 |
| è‡ªåŠ¨é”™è¯¯æ¢å¤ | â­â­â­â­ | L | æ—¥å¿—ç³»ç»Ÿ | Week 4 |
| æƒé™æ£€æŸ¥å’Œä¿®å¤ | â­â­â­â­ | M | æ—  | Week 5 |
| é…ç½®å®¡è®¡åŠŸèƒ½ | â­â­â­â­ | M | æ—¥å¿—ç³»ç»Ÿ | Week 5 |

**é‡Œç¨‹ç¢‘**: å¯é æ€§è¾¾åˆ°ä¼ä¸šçº§æ ‡å‡†

#### é˜¶æ®µ3: æµ‹è¯•å’ŒCI/CD (2å‘¨)

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | ä¾èµ– | é¢„æœŸå®Œæˆ |
|-----|--------|--------|------|----------|
| å¢å¼ºæµ‹è¯•è¦†ç›–ç‡ | â­â­â­â­ | XL | æ‰€æœ‰åŠŸèƒ½ | Week 6 |
| CI/CDé›†æˆ | â­â­â­â­ | L | æµ‹è¯•å¥—ä»¶ | Week 6 |
| æ€§èƒ½å›å½’æµ‹è¯• | â­â­â­â­ | M | æµ‹è¯•å¥—ä»¶ | Week 7 |
| è·¨å¹³å°æµ‹è¯• | â­â­â­â­ | L | æµ‹è¯•å¥—ä»¶ | Week 7 |

**é‡Œç¨‹ç¢‘**: è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²å°±ç»ª

#### é˜¶æ®µ4: ä¼ä¸šçº§ç‰¹æ€§ (2å‘¨)

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | ä¾èµ– | é¢„æœŸå®Œæˆ |
|-----|--------|--------|------|----------|
| å¤šç¯å¢ƒé…ç½®ç®¡ç† | â­â­â­ | M | è¿ç§»å·¥å…· | Week 8 |
| æ’ä»¶ç³»ç»Ÿ | â­â­â­ | L | ç‰ˆæœ¬ç®¡ç† | Week 9 |
| é…ç½®åŠ å¯† | â­â­â­ | M | æ—  | Week 9 |
| äº¤äº’å¼å‘å¯¼å¢å¼º | â­â­â­ | L | æ‰€æœ‰åŠŸèƒ½ | Week 9 |

**é‡Œç¨‹ç¢‘**: ä¼ä¸šçº§åŠŸèƒ½å®Œæ•´

#### é˜¶æ®µ5: ç”¨æˆ·ä½“éªŒä¼˜åŒ– (1å‘¨)

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | ä¾èµ– | é¢„æœŸå®Œæˆ |
|-----|--------|--------|------|----------|
| é…ç½®æ¨¡æ¿ç³»ç»Ÿ | â­â­â­ | M | è¿ç§»å·¥å…· | Week 10 |
| æ•…éšœæ’é™¤æŒ‡å—å¢å¼º | â­â­â­ | S | æ‰€æœ‰åŠŸèƒ½ | Week 10 |
| WSLæ”¯æŒå¢å¼º | â­â­â­ | M | å¥åº·æ£€æŸ¥ | Week 10 |
| åŒ…ç®¡ç†å™¨æ£€æµ‹å¢å¼º | â­â­â­ | S | æ—  | Week 10 |

**é‡Œç¨‹ç¢‘**: v3.0 å‘å¸ƒ

---

### 4.2 æ–‡ä»¶æ¸…å•

#### æ–°å¢æ–‡ä»¶

```
scripts/
â”œâ”€â”€ zsh_version_manager.sh       # ç‰ˆæœ¬ç®¡ç†å™¨ â­
â”œâ”€â”€ zsh_migrate.sh                # é…ç½®è¿ç§»å·¥å…· â­
â”œâ”€â”€ zsh_health_check.sh           # å¥åº·æ£€æŸ¥è„šæœ¬ â­
â”œâ”€â”€ zsh_recovery.sh               # é”™è¯¯æ¢å¤å·¥å…· â­
â”œâ”€â”€ zsh_audit.sh                  # é…ç½®å®¡è®¡å·¥å…·
â”œâ”€â”€ zsh_env.sh                    # ç¯å¢ƒç®¡ç†å·¥å…·
â””â”€â”€ zsh_crypt.sh                  # é…ç½®åŠ å¯†å·¥å…·

zsh-functions/
â”œâ”€â”€ version.zsh                   # ç‰ˆæœ¬ç®¡ç†å‡½æ•°
â”œâ”€â”€ migrate.zsh                   # è¿ç§»å‡½æ•°
â”œâ”€â”€ health.zsh                    # å¥åº·æ£€æŸ¥å‡½æ•°
â”œâ”€â”€ recovery.zsh                  # æ¢å¤å‡½æ•°
â””â”€â”€ logging.zsh                   # æ—¥å¿—å‡½æ•°

config/
â”œâ”€â”€ environment/
â”‚   â”œâ”€â”€ work.zsh                  # å·¥ä½œç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ personal.zsh              # ä¸ªäººç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ development.zsh           # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ production.zsh            # ç”Ÿäº§ç¯å¢ƒé…ç½®
â””â”€â”€ templates/
    â”œâ”€â”€ minimal.zshrc             # æœ€å°é…ç½®æ¨¡æ¿
    â”œâ”€â”€ standard.zshrc            # æ ‡å‡†é…ç½®æ¨¡æ¿
    â”œâ”€â”€ full.zshrc                # å®Œæ•´é…ç½®æ¨¡æ¿
    â””â”€â”€ matrix.zshrc              # Matrixé…ç½®æ¨¡æ¿

docs/
â”œâ”€â”€ CONFIG_LIFECYCLE_MANAGEMENT.md # æœ¬æ–‡æ¡£
â”œâ”€â”€ MIGRATION_GUIDE.md            # è¿ç§»æŒ‡å—
â”œâ”€â”€ HEALTH_CHECK_GUIDE.md         # å¥åº·æ£€æŸ¥æŒ‡å—
â”œâ”€â”€ RECOVERY_GUIDE.md             # æ¢å¤æŒ‡å—
â””â”€â”€ VERSION_MANAGEMENT.md         # ç‰ˆæœ¬ç®¡ç†æ–‡æ¡£

tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ test_version_manager.sh   # ç‰ˆæœ¬ç®¡ç†æµ‹è¯•
â”‚   â”œâ”€â”€ test_migration.sh         # è¿ç§»æµ‹è¯•
â”‚   â”œâ”€â”€ test_health_check.sh      # å¥åº·æ£€æŸ¥æµ‹è¯•
â”‚   â””â”€â”€ test_recovery.sh          # æ¢å¤æµ‹è¯•
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ test_upgrade_workflow.sh  # å‡çº§æµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ test_rollback_workflow.sh # å›æ»šæµç¨‹æµ‹è¯•
â”‚   â””â”€â”€ test_migration_workflow.sh # è¿ç§»æµç¨‹æµ‹è¯•
â””â”€â”€ e2e/
    â”œâ”€â”€ test_new_user_installation.sh
    â”œâ”€â”€ test_existing_user_upgrade.sh
    â””â”€â”€ test_disaster_recovery.sh
```

#### ä¿®æ”¹æ–‡ä»¶

```
scripts/
â”œâ”€â”€ install_zsh_config.sh         # æ·»åŠ ç‰ˆæœ¬ç®¡ç†æ”¯æŒ
â”œâ”€â”€ zsh_tools.sh                  # é›†æˆæ–°åŠŸèƒ½
â””â”€â”€ zsh_optimizer.sh              # å¢å¼ºæ€§èƒ½åˆ†æ

config/
â””â”€â”€ .zshrc                        # æ·»åŠ ç®¡ç†åŒºåŸŸæ ‡è®°

docs/
â”œâ”€â”€ README.md                     # æ›´æ–°æ–‡æ¡£
â”œâ”€â”€ CLAUDE.md                     # æ›´æ–°æ¨¡å—è¯´æ˜
â””â”€â”€ management/
    â”œâ”€â”€ PRD.md                    # æ›´æ–°äº§å“éœ€æ±‚
    â”œâ”€â”€ PLANNING.md               # æ›´æ–°æ¶æ„è§„åˆ’
    â””â”€â”€ TASK.md                   # æ›´æ–°ä»»åŠ¡è¿½è¸ª
```

---

### 4.3 éªŒè¯æ–¹æ³•

#### åŠŸèƒ½éªŒè¯

```bash
# ç‰ˆæœ¬ç®¡ç†éªŒè¯
test_version_management() {
    echo "æµ‹è¯•ç‰ˆæœ¬ç®¡ç†..."

    # 1. åˆå§‹åŒ–ç‰ˆæœ¬æ–‡ä»¶
    ./scripts/zsh_version_manager.sh init
    assert_file_exists ~/.zsh-version

    # 2. æ£€æŸ¥ç‰ˆæœ¬
    local version=$(./scripts/zsh_version_manager.sh current)
    assert_not_empty "$version"

    # 3. å‡çº§æµ‹è¯•
    ./scripts/zsh_version_manager.sh upgrade
    assert_eq "$?" "0"

    # 4. å›æ»šæµ‹è¯•
    ./scripts/zsh_version_manager.sh rollback
    assert_eq "$?" "0"
}

# è¿ç§»éªŒè¯
test_migration() {
    echo "æµ‹è¯•é…ç½®è¿ç§»..."

    # 1. åˆ›å»ºæµ‹è¯•é…ç½®
    create_test_config

    # 2. æ‰§è¡Œè¿ç§»
    ./scripts/zsh_migrate.sh migrate
    assert_eq "$?" "0"

    # 3. éªŒè¯ç”¨æˆ·è‡ªå®šä¹‰ä¿ç•™
    assert_contains ~/.zshrc "# === User Custom ==="

    # 4. éªŒè¯åŠŸèƒ½æ­£å¸¸
    zsh -c 'source ~/.zshrc && check_environment'
    assert_eq "$?" "0"
}

# å¥åº·æ£€æŸ¥éªŒè¯
test_health_check() {
    echo "æµ‹è¯•å¥åº·æ£€æŸ¥..."

    # 1. è¿è¡Œå¥åº·æ£€æŸ¥
    ./scripts/zsh_health_check.sh check
    local result=$?

    # 2. éªŒè¯ç»“æœ
    if [[ $result -eq 0 ]]; then
        echo "âœ… å¥åº·æ£€æŸ¥é€šè¿‡"
    else
        echo "âŒ å¥åº·æ£€æŸ¥å¤±è´¥"
        return 1
    fi

    # 3. æµ‹è¯•è‡ªåŠ¨ä¿®å¤
    ./scripts/zsh_health_check.sh check --auto-fix
    assert_eq "$?" "0"
}

# æ¢å¤éªŒè¯
test_recovery() {
    echo "æµ‹è¯•é”™è¯¯æ¢å¤..."

    # 1. åˆ›å»ºæŸåçš„é…ç½®
    create_broken_config

    # 2. æµ‹è¯•è‡ªåŠ¨æ¢å¤
    ./scripts/zsh_recovery.sh auto-recover
    assert_eq "$?" "0"

    # 3. éªŒè¯é…ç½®å¯ç”¨
    zsh -n ~/.zshrc
    assert_eq "$?" "0"
}
```

#### æ€§èƒ½éªŒè¯

```bash
# æ€§èƒ½åŸºå‡†æµ‹è¯•
benchmark_lifecycle() {
    echo "ç”Ÿå‘½å‘¨æœŸç®¡ç†æ€§èƒ½æµ‹è¯•..."

    # 1. ç‰ˆæœ¬æ£€æŸ¥æ€§èƒ½
    time ./scripts/zsh_version_manager.sh check
    # é¢„æœŸ: <1s

    # 2. è¿ç§»æ€§èƒ½
    time ./scripts/zsh_migrate.sh migrate
    # é¢„æœŸ: <5s

    # 3. å¥åº·æ£€æŸ¥æ€§èƒ½
    time ./scripts/zsh_health_check.sh check
    # é¢„æœŸ: <3s

    # 4. æ¢å¤æ€§èƒ½
    time ./scripts/zsh_recovery.sh auto-recover
    # é¢„æœŸ: <2s
}

# å†…å­˜å ç”¨æµ‹è¯•
memory_test() {
    echo "å†…å­˜å ç”¨æµ‹è¯•..."

    local before=$(get_memory_usage)

    # åŠ è½½æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½
    source scripts/zsh_version_manager.sh
    source scripts/zsh_migrate.sh
    source scripts/zsh_health_check.sh
    source scripts/zsh_recovery.sh

    local after=$(get_memory_usage)
    local diff=$((after - before))

    echo "å†…å­˜å¢é•¿: ${diff}KB"
    assert_lt "$diff" "10240"  # <10MB
}
```

#### é›†æˆéªŒè¯

```bash
# ç«¯åˆ°ç«¯æµ‹è¯•
e2e_test_upgrade_workflow() {
    echo "E2E: å‡çº§æµç¨‹æµ‹è¯•..."

    # 1. æ¨¡æ‹Ÿv2.1å®‰è£…
    setup_version "2.1.0"

    # 2. æ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰
    add_user_custom_config

    # 3. æ‰§è¡Œå‡çº§
    ./scripts/install_zsh_config.sh --upgrade

    # 4. éªŒè¯å‡çº§æˆåŠŸ
    assert_file_contains ~/.zsh-version "2.2.0"

    # 5. éªŒè¯ç”¨æˆ·è‡ªå®šä¹‰ä¿ç•™
    assert_file_contains ~/.zshrc "my_custom_alias"

    # 6. éªŒè¯åŠŸèƒ½æ­£å¸¸
    test_all_functions

    # 7. æµ‹è¯•å›æ»š
    ./scripts/zsh_version_manager.sh rollback "2.1.0"
    assert_file_contains ~/.zsh-version "2.1.0"
}

e2e_test_disaster_recovery() {
    echo "E2E: ç¾éš¾æ¢å¤æµ‹è¯•..."

    # 1. æ­£å¸¸å®‰è£…
    ./scripts/install_zsh_config.sh

    # 2. åˆ›å»ºæ¢å¤ç‚¹
    ./scripts/zsh_recovery.sh create-restore-point "test"

    # 3. æ¨¡æ‹Ÿç¾éš¾
    rm -f ~/.zshrc
    echo "broken config" > ~/.zshrc

    # 4. æµ‹è¯•æ¢å¤
    ./scripts/zsh_recovery.sh restore-to-point "test-*"

    # 5. éªŒè¯æ¢å¤æˆåŠŸ
    zsh -n ~/.zshrc
    assert_eq "$?" "0"
}
```

---

## 5. é™„å½•

### 5.1 æœ¯è¯­è¡¨

| æœ¯è¯­ | ï¿½ï¿½ï¿½ä¹‰ |
|-----|------|
| **é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†** | å¯¹é…ç½®ä»åˆ›å»ºåˆ°åºŸå¼ƒçš„å…¨è¿‡ç¨‹ç®¡ç† |
| **ç‰ˆæœ¬ç®¡ç†** | è¿½è¸ªé…ç½®ç‰ˆæœ¬ï¼Œæ”¯æŒå‡çº§å’Œå›æ»š |
| **è¿ç§»** | å°†é…ç½®ä»ä¸€ä¸ªç‰ˆæœ¬è½¬æ¢åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬ |
| **å¥åº·æ£€æŸ¥** | ç³»ç»Ÿæ€§åœ°æ£€æŸ¥é…ç½®çŠ¶æ€å’ŒåŠŸèƒ½ |
| **æ¢å¤ç‚¹** | å¯ä»¥æ¢å¤åˆ°çš„å·²çŸ¥è‰¯å¥½çŠ¶æ€ |
| **é…ç½®æ¼‚ç§»** | å®é™…é…ç½®ä¸é¢„æœŸé…ç½®çš„å·®å¼‚ |
| **é…ç½®æ¼‚ç§»æ£€æµ‹** | è¯†åˆ«é…ç½®å·®å¼‚çš„è¿‡ç¨‹ |
| **è‡ªåŠ¨ä¿®å¤** | æ— éœ€äººå·¥å¹²é¢„çš„ä¿®å¤æœºåˆ¶ |
| **å®‰å…¨æ¨¡å¼** | æœ€å°åŒ–é…ç½®çš„å¯åŠ¨æ¨¡å¼ |

### 5.2 å‚è€ƒèµ„æ–™

#### å†…éƒ¨æ–‡æ¡£

- [OPTIMIZATION_RECOMMENDATIONS_V2.md](../OPTIMIZATION_RECOMMENDATIONS_V2.md) - ç¬¬äºŒè½®ä¼˜åŒ–å»ºè®®
- [OPTIMIZATION_RECOMMENDATIONS.md](../OPTIMIZATION_RECOMMENDATIONS.md) - ç¬¬ä¸€è½®ä¼˜åŒ–å»ºè®®
- [management/PRD.md](management/PRD.md) - äº§å“éœ€æ±‚æ–‡æ¡£
- [management/PLANNING.md](management/PLANNING.md) - æŠ€æœ¯æ¶æ„è§„åˆ’
- [management/TASK.md](management/TASK.md) - ä»»åŠ¡è¿½è¸ª

#### å¤–éƒ¨èµ„æº

- [Semantic Versioning](https://semver.org/) - è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ
- [ZSH Documentation](https://zsh.sourceforge.io/Doc/) - ZSHå®˜æ–¹æ–‡æ¡£
- [Antigen Documentation](https://github.com/zsh-users/antigen) - Antigenæ’ä»¶ç®¡ç†å™¨
- [Powerlevel10k](https://github.com/romkatv/powerlevel10k) - Powerlevel10kä¸»é¢˜

### 5.3 å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ | ä½œè€… |
|-----|------|------|------|
| 1.0.0 | 2025-01-31 | åˆå§‹ç‰ˆæœ¬åˆ›å»º | Dev-Env Team |

### 5.4 è´¡çŒ®è€…

| å§“å | è§’è‰² | è´¡çŒ® |
|-----|------|------|
| Dev-Env Team | ç»´æŠ¤è€… | æ¶æ„è®¾è®¡ã€æ–‡æ¡£ç¼–å†™ |

### 5.5 è®¸å¯è¯

æœ¬æ–‡æ¡£éµå¾ªä¸dev-envé¡¹ç›®ç›¸åŒçš„è®¸å¯è¯ã€‚

---

**æ–‡æ¡£ç»“æŸ**

*æ­¤æ–‡æ¡£æ˜¯dev-envé¡¹ç›®é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†ç³»ç»Ÿçš„å®Œæ•´å­˜æ¡£ï¼Œè®°å½•äº†ä»v2.1åˆ°v3.0çš„å®Œæ•´æ¶æ„è®¾è®¡ã€‚*
